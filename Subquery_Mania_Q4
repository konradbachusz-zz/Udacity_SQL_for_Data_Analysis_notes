--Q4 For the customer that spent the most (in total over their lifetime as a customer) total_amt_usd, how many web_events did they have for each channel?


WITH SPENDER AS(
SELECT ACCOUNT_ID, MAX(TOTAL_AMT_USD)
FROM ORDERS
GROUP BY ACCOUNT_ID
ORDER BY 2
DESC
LIMIT 1),

WEB_EVENTS_BY_CHANNEL AS(
    SELECT ACCOUNT_ID, CHANNEL, COUNT(ID)
    FROM WEB_EVENTS
    GROUP BY CHANNEL, ACCOUNT_ID
)

SELECT *
FROM WEB_EVENTS_BY_CHANNEL
WHERE ACCOUNT_ID=(SELECT ACCOUNT_ID FROM SPENDER)
